<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel del Evento</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Font elegante -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="evento-container">

  <!-- PORTADA -->
  <div class="portada" id="portadaEvento">
    <div class="portada-overlay">
      <h1 id="nombreEvento"></h1>
    </div>
  </div>

  <!-- CUENTA REGRESIVA -->
  <div class="card contador-card">
    <h2>Cuenta regresiva</h2>

    <div class="contador-grid">
      <div class="tiempo-box">
        <span id="dias">0</span>
        <small>Días</small>
      </div>
      <div class="tiempo-box">
        <span id="horas">0</span>
        <small>Horas</small>
      </div>
      <div class="tiempo-box">
        <span id="minutos">0</span>
        <small>Minutos</small>
      </div>
      <div class="tiempo-box">
        <span id="segundos">0</span>
        <small>Segundos</small>
      </div>
    </div>
  </div>

  <!-- SERVICIO + PAGO INTEGRADO -->
  <div class="card servicio-card">

    <h2>Servicio contratado</h2>
    <h3 id="comboNombre" class="combo-titulo"></h3>

    <div class="servicio-grid">

      <!-- LISTA -->
      <div>
        <ul id="listaIncluye"></ul>
      </div>

      <!-- PAGO VISUAL -->
      <div class="pago-box">
        <div class="progress-circle">
          <svg width="120" height="120">
            <circle cx="60" cy="60" r="50" class="bg-circle"/>
            <circle cx="60" cy="60" r="50" class="progress-circle-fill" id="progressCircle"/>
          </svg>
          <div class="progress-text" id="porcentajePago">0%</div>
        </div>

        <div class="resumen-pago">
          <p>Total: $<span id="total"></span></p>
          <p>Pagado: $<span id="pagado"></span></p>
          <p>Saldo: $<span id="saldo"></span></p>
          <div id="estadoPago" class="estado-badge"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- EXTRAS -->
  <div class="card">
    <h2>Servicios extras</h2>
    <div id="extrasContainer"></div>
  </div>

  <!-- UBICACIÓN -->
  <div class="card">
    <h2>Ubicación del evento</h2>
    <p class="ubicacion" id="ubicacion"></p>
    <a 
      class="mapa-btn"
      href="https://maps.app.goo.gl/C2YfQ2MfvFFFH38VA"
      target="_blank">
      Ver en Google Maps
    </a>
  </div>

</div>

<script src="script.js"></script>

<script>
const params = new URLSearchParams(window.location.search);
const codigo = params.get("codigo");

if (!clientes[codigo]) {
  document.body.innerHTML = "<h2 style='padding:20px'>Código inválido</h2>";
} else {

  const cliente = clientes[codigo];

  document.getElementById("nombreEvento").textContent = cliente.nombre;
  document.getElementById("ubicacion").textContent = cliente.ubicacion;

  document.getElementById("portadaEvento").style.backgroundImage =
    "url('https://images.unsplash.com/photo-1529634898651-9f31a9b5b0c5')";

  document.getElementById("comboNombre").textContent = cliente.combo;

  const lista = document.getElementById("listaIncluye");
  cliente.incluye.forEach(item => {
    const li = document.createElement("li");
    li.textContent = item;
    lista.appendChild(li);
  });

  document.getElementById("total").textContent = cliente.total.toLocaleString();
  document.getElementById("pagado").textContent = cliente.pagado.toLocaleString();

  const saldo = cliente.total - cliente.pagado;
  document.getElementById("saldo").textContent = saldo.toLocaleString();

  const porcentaje = Math.min((cliente.pagado / cliente.total) * 100, 100);
  document.getElementById("porcentajePago").textContent = Math.round(porcentaje) + "%";

  const circle = document.getElementById("progressCircle");
  const radius = 50;
  const circumference = 2 * Math.PI * radius;
  circle.style.strokeDasharray = circumference;
  circle.style.strokeDashoffset = circumference - (porcentaje / 100) * circumference;

  const estado = document.getElementById("estadoPago");
  if (saldo <= 0) {
    estado.textContent = "Pago completo";
    estado.classList.add("estado-ok");
  } else {
    estado.textContent = "Pago pendiente";
    estado.classList.add("estado-pendiente");
  }

  // CONTADOR
  function actualizarContador() {
    const fechaEvento = new Date(cliente.fecha).getTime();
    const ahora = new Date().getTime();
    const diferencia = fechaEvento - ahora;

    if (diferencia <= 0) return;

    document.getElementById("dias").innerText =
      Math.floor(diferencia / (1000 * 60 * 60 * 24));

    document.getElementById("horas").innerText =
      Math.floor((diferencia / (1000 * 60 * 60)) % 24);

    document.getElementById("minutos").innerText =
      Math.floor((diferencia / (1000 * 60)) % 60);

    document.getElementById("segundos").innerText =
      Math.floor((diferencia / 1000) % 60);
  }

  actualizarContador();
  setInterval(actualizarContador, 1000);

}
</script>

</body>
</html>
